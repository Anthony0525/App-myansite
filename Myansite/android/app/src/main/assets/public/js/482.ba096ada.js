"use strict";(self["webpackChunkproyectexample"]=self["webpackChunkproyectexample"]||[]).push([[482],{2482:function(e,a,l){l.r(a),l.d(a,{default:function(){return _}});l(4114),l(8111),l(2489);var u=l(6768),t=l(144),n=l(4232),s=l(4790),d=l(1300),c=l(1387);const i=["src"],r={class:"chat-messages"};var o={__name:"ChatsView",setup(e){const a=(0,d.UU)("https://neffqwnqpcydidpkysfi.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."),l=(0,c.rd)(),o=(0,t.KR)("comunes"),k=(0,t.KR)([]),v=(0,t.KR)(null),_=(0,t.KR)([]),f=(0,t.KR)(""),b=(0,t.KR)(null);(0,u.sV)((async()=>{const{data:e,error:u}=await a.auth.getUser();if(u||!e.user)return void l.push("/login");b.value=e.user.id;const{data:t}=await a.from("chats").select("*");k.value=t||[]}));const m=(0,u.EW)((()=>k.value.filter((e=>e.type===o.value)))),R=async e=>{v.value=e;const{data:l}=await a.from("messages").select("*").eq("chat_id",e.id).order("created_at",{ascending:!0});_.value=l||[],a.channel("chat-room-"+e.id).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`chat_id=eq.${e.id}`},(e=>{_.value.push(e.new)})).subscribe()},p=()=>{v.value=null,_.value=[]},h=async()=>{f.value.trim()&&v.value&&(await a.from("messages").insert([{chat_id:v.value.id,sender_id:b.value,content:f.value}]),f.value="")};return(e,a)=>((0,u.uX)(),(0,u.Wv)((0,t.R1)(s.AO),{class:"chat-page"},{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(s.eU),null,{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(s.ai),null,{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(s.Gp),{modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e)},{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(s.eP),{value:"comunes"},{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(s.he),null,{default:(0,u.k6)((()=>a[2]||(a[2]=[(0,u.eW)("Comunes")]))),_:1})])),_:1}),(0,u.bF)((0,t.R1)(s.eP),{value:"importantes"},{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(s.he),null,{default:(0,u.k6)((()=>a[3]||(a[3]=[(0,u.eW)("Importantes")]))),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,u.bF)((0,t.R1)(s.W9),{class:"ion-padding chat-content"},{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(s.nf),null,{default:(0,u.k6)((()=>[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(m.value,(e=>((0,u.uX)(),(0,u.Wv)((0,t.R1)(s.b_),{key:e.id,onClick:a=>R(e),class:"chat-card"},{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(s.uz),{lines:"none"},{start:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(s.mC),null,{default:(0,u.k6)((()=>[(0,u.Lk)("img",{src:e.user_avatar,alt:"avatar"},null,8,i)])),_:2},1024)])),default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(s.he),null,{default:(0,u.k6)((()=>[(0,u.Lk)("h2",null,(0,n.v_)(e.username),1),(0,u.Lk)("p",null,(0,n.v_)(e.last_message),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),(0,u.bF)((0,t.R1)(s.Sb),{"is-open":null!==v.value,onDidDismiss:p},{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(s.eU),null,{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(s.ai),null,{start:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(s.QW),null,{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(s.Jm),{onClick:p},{default:(0,u.k6)((()=>a[4]||(a[4]=[(0,u.eW)("Cerrar")]))),_:1})])),_:1})])),default:(0,u.k6)((()=>[v.value?((0,u.uX)(),(0,u.Wv)((0,t.R1)(s.BC),{key:0},{default:(0,u.k6)((()=>[(0,u.eW)((0,n.v_)(v.value.username),1)])),_:1})):(0,u.Q3)("",!0)])),_:1})])),_:1}),(0,u.bF)((0,t.R1)(s.W9),{class:"chat-modal"},{default:(0,u.k6)((()=>[(0,u.Lk)("div",r,[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(_.value,(e=>((0,u.uX)(),(0,u.CE)("div",{key:e.id,class:(0,n.C4)(["chat-bubble",e.sender_id===b.value?"own":"other"])},[(0,u.Lk)("p",null,(0,n.v_)(e.content),1)],2)))),128))])])),_:1}),(0,u.bF)((0,t.R1)(s.M0),null,{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(s.ai),null,{default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(s.uz),null,{end:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(s.Jm),{onClick:h},{default:(0,u.k6)((()=>a[5]||(a[5]=[(0,u.eW)("Enviar")]))),_:1})])),default:(0,u.k6)((()=>[(0,u.bF)((0,t.R1)(s.$w),{modelValue:f.value,"onUpdate:modelValue":a[1]||(a[1]=e=>f.value=e),placeholder:"Escribe un mensaje..."},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["is-open"])])),_:1}))}},k=l(1241);const v=(0,k.A)(o,[["__scopeId","data-v-2b8afd3e"]]);var _=v}}]);