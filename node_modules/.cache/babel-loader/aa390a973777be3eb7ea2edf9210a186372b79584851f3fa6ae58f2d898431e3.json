{"ast":null,"code":"import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createTextVNode as _createTextVNode, normalizeClass as _normalizeClass, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, createStaticVNode as _createStaticVNode } from \"vue\";\nimport _imports_0 from '@/assets/profile-background.jpg';\nconst _hoisted_1 = {\n  class: \"profile-container\"\n};\nconst _hoisted_2 = {\n  class: \"profile-card\"\n};\nconst _hoisted_3 = {\n  class: \"profile-content\"\n};\nconst _hoisted_4 = {\n  class: \"user-info-section\"\n};\nconst _hoisted_5 = [\"src\"];\nconst _hoisted_6 = {\n  class: \"username\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_cache[5] || (_cache[5] = _createStaticVNode(\"<div class=\\\"top-section\\\"><div class=\\\"label-box\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"24\\\" height=\\\"24\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"feather feather-camera\\\"><path d=\\\"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z\\\"></path><circle cx=\\\"12\\\" cy=\\\"13\\\" r=\\\"4\\\"></circle></svg><span>Label</span><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"24\\\" height=\\\"24\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"feather feather-chevron-down\\\"><polyline points=\\\"6 9 12 15 18 9\\\"></polyline></svg></div></div>\", 1)), _createElementVNode(\"div\", _hoisted_3, [_cache[4] || (_cache[4] = _createElementVNode(\"img\", {\n    src: _imports_0,\n    alt: \"Fondo del perfil\",\n    class: \"content-image\"\n  }, null, -1 /* HOISTED */)), _createElementVNode(\"button\", {\n    class: _normalizeClass([\"accordion-button\", {\n      'is-active': $setup.activeAccordion === 'gustos'\n    }]),\n    onClick: _cache[0] || (_cache[0] = $event => $setup.toggleAccordion('gustos'))\n  }, _cache[2] || (_cache[2] = [_createTextVNode(\" Gustos \"), _createElementVNode(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: \"24\",\n    height: \"24\",\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    stroke: \"currentColor\",\n    \"stroke-width\": \"2\",\n    \"stroke-linecap\": \"round\",\n    \"stroke-linejoin\": \"round\",\n    class: \"feather feather-chevron-down\"\n  }, [_createElementVNode(\"polyline\", {\n    points: \"6 9 12 15 18 9\"\n  })], -1 /* HOISTED */)]), 2 /* CLASS */), _createElementVNode(\"div\", {\n    class: _normalizeClass([\"accordion-panel\", {\n      'is-active': $setup.activeAccordion === 'gustos'\n    }])\n  }, [_createElementVNode(\"ul\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.profileData.gustos, (gusto, index) => {\n    return _openBlock(), _createElementBlock(\"li\", {\n      key: index\n    }, _toDisplayString(gusto), 1 /* TEXT */);\n  }), 128 /* KEYED_FRAGMENT */))])], 2 /* CLASS */), _createElementVNode(\"button\", {\n    class: _normalizeClass([\"accordion-button\", {\n      'is-active': $setup.activeAccordion === 'logros'\n    }]),\n    onClick: _cache[1] || (_cache[1] = $event => $setup.toggleAccordion('logros'))\n  }, _cache[3] || (_cache[3] = [_createTextVNode(\" Logros \"), _createElementVNode(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: \"24\",\n    height: \"24\",\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    stroke: \"currentColor\",\n    \"stroke-width\": \"2\",\n    \"stroke-linecap\": \"round\",\n    \"stroke-linejoin\": \"round\",\n    class: \"feather feather-chevron-down\"\n  }, [_createElementVNode(\"polyline\", {\n    points: \"6 9 12 15 18 9\"\n  })], -1 /* HOISTED */)]), 2 /* CLASS */), _createElementVNode(\"div\", {\n    class: _normalizeClass([\"accordion-panel\", {\n      'is-active': $setup.activeAccordion === 'logros'\n    }])\n  }, [_createElementVNode(\"ul\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.profileData.logros, (logro, index) => {\n    return _openBlock(), _createElementBlock(\"li\", {\n      key: index\n    }, _toDisplayString(logro), 1 /* TEXT */);\n  }), 128 /* KEYED_FRAGMENT */))])], 2 /* CLASS */), _createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"div\", {\n    class: \"user-avatar-container\",\n    onClick: $setup.changeAvatar\n  }, [_createElementVNode(\"img\", {\n    src: $setup.profileData.avatar_url,\n    alt: \"Avatar del usuario\",\n    class: \"user-avatar\"\n  }, null, 8 /* PROPS */, _hoisted_5), _createElementVNode(\"input\", {\n    type: \"file\",\n    ref: \"avatarInput\",\n    style: {\n      \"display\": \"none\"\n    },\n    onChange: $setup.handleFileChange,\n    accept: \"image/*\"\n  }, null, 544 /* NEED_HYDRATION, NEED_PATCH */)]), _createElementVNode(\"span\", _hoisted_6, _toDisplayString($setup.profileData.username), 1 /* TEXT */)])])])]);\n}","map":{"version":3,"names":["_imports_0","class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createStaticVNode","_hoisted_3","src","alt","_normalizeClass","$setup","activeAccordion","onClick","_cache","$event","toggleAccordion","_createTextVNode","xmlns","width","height","viewBox","fill","stroke","points","_Fragment","_renderList","profileData","gustos","gusto","index","key","_toDisplayString","logros","logro","_hoisted_4","changeAvatar","avatar_url","_hoisted_5","type","ref","style","onChange","handleFileChange","accept","_hoisted_6","username"],"sources":["C:\\Users\\ellen\\Downloads\\App en Vue\\Myansite\\Myansite\\src\\views\\PerfilView.vue"],"sourcesContent":["<template>\r\n  <div class=\"profile-container\">\r\n    <div class=\"profile-card\">\r\n      <div class=\"top-section\">\r\n        <div class=\"label-box\">\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-camera\"><path d=\"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z\"></path><circle cx=\"12\" cy=\"13\" r=\"4\"></circle></svg>\r\n          <span>Label</span>\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-chevron-down\"><polyline points=\"6 9 12 15 18 9\"></polyline></svg>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"profile-content\">\r\n        <img src=\"@/assets/profile-background.jpg\" alt=\"Fondo del perfil\" class=\"content-image\" />\r\n        \r\n        <button\r\n          class=\"accordion-button\"\r\n          :class=\"{ 'is-active': activeAccordion === 'gustos' }\"\r\n          @click=\"toggleAccordion('gustos')\"\r\n        >\r\n          Gustos\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-chevron-down\"><polyline points=\"6 9 12 15 18 9\"></polyline></svg>\r\n        </button>\r\n        <div class=\"accordion-panel\" :class=\"{ 'is-active': activeAccordion === 'gustos' }\">\r\n          <ul>\r\n            <li v-for=\"(gusto, index) in profileData.gustos\" :key=\"index\">{{ gusto }}</li>\r\n          </ul>\r\n        </div>\r\n        \r\n        <button\r\n          class=\"accordion-button\"\r\n          :class=\"{ 'is-active': activeAccordion === 'logros' }\"\r\n          @click=\"toggleAccordion('logros')\"\r\n        >\r\n          Logros\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-chevron-down\"><polyline points=\"6 9 12 15 18 9\"></polyline></svg>\r\n        </button>\r\n        <div class=\"accordion-panel\" :class=\"{ 'is-active': activeAccordion === 'logros' }\">\r\n          <ul>\r\n            <li v-for=\"(logro, index) in profileData.logros\" :key=\"index\">{{ logro }}</li>\r\n          </ul>\r\n        </div>\r\n        \r\n        <div class=\"user-info-section\">\r\n          <div class=\"user-avatar-container\" @click=\"changeAvatar\">\r\n            <img :src=\"profileData.avatar_url\" alt=\"Avatar del usuario\" class=\"user-avatar\" />\r\n            <input\r\n              type=\"file\"\r\n              ref=\"avatarInput\"\r\n              style=\"display: none\"\r\n              @change=\"handleFileChange\"\r\n              accept=\"image/*\"\r\n            />\r\n          </div>\r\n          <span class=\"username\">{{ profileData.username }}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from \"vue\";\r\nimport { createClient } from \"@supabase/supabase-js\";\r\nimport \"@/assets/Perfil.css\";\r\n\r\n// 👉 Usando la misma constante de Supabase que proporcionaste\r\nconst supabase = createClient(\"https://neffqwnqpcydidpkysfi.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5lZmZxd25xcGN5ZGlkcGt5c2ZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3Nzc5MTUsImV4cCI6MjA3MjM1MzkxNX0.I_fwrJYMhKoh2Irlhqub3B5Kn4-JxuJR-XnLhGjUykw\");\r\n\r\n// Estado del acordeón\r\nconst activeAccordion = ref(null);\r\n\r\n// 👉 Eliminando datos fijos y usando un objeto vacío\r\nconst profileData = ref({\r\n  username: '',\r\n  avatar_url: '',\r\n  gustos: [],\r\n  logros: []\r\n});\r\n\r\n// Referencia al input de archivo para cambiar el avatar\r\nconst avatarInput = ref(null);\r\n\r\n// Lógica para abrir/cerrar acordeones\r\nconst toggleAccordion = (panelName) => {\r\n  activeAccordion.value = activeAccordion.value === panelName ? null : panelName;\r\n};\r\n\r\n// Función para activar el input de archivo al hacer clic en el avatar\r\nconst changeAvatar = () => {\r\n  avatarInput.value.click();\r\n};\r\n\r\n// Maneja la selección del archivo y lo sube a Supabase Storage\r\nconst handleFileChange = async (event) => {\r\n  const file = event.target.files[0];\r\n  if (!file) return;\r\n\r\n  try {\r\n    const filePath = `avatars/${profileData.value.username}/${Date.now()}.${file.name.split('.').pop()}`;\r\n    \r\n    const { data, error } = await supabase.storage\r\n      .from('avatars')\r\n      .upload(filePath, file);\r\n\r\n    if (error) throw error;\r\n\r\n    const publicUrl = `https://neffqwnqpcydidpkysfi.supabase.co/storage/v1/object/public/${data.path}`;\r\n    \r\n    const { error: updateError } = await supabase\r\n      .from('profiles')\r\n      .update({ avatar_url: publicUrl })\r\n      .eq('username', profileData.value.username);\r\n\r\n    if (updateError) throw updateError;\r\n    \r\n    profileData.value.avatar_url = publicUrl;\r\n\r\n    alert('✅ Imagen de perfil actualizada correctamente!');\r\n  } catch (error) {\r\n    console.error('Error al subir la imagen:', error.message);\r\n    alert('❌ Error al subir la imagen. Inténtalo de nuevo.');\r\n  }\r\n};\r\n\r\n// 👉 Función para cargar todos los datos del perfil\r\nconst fetchProfileData = async () => {\r\n  try {\r\n    // ⚠️ Importante: Obtener el nombre de usuario del usuario autenticado\r\n    const usuarioActual = JSON.parse(localStorage.getItem(\"usuario\"));\r\n    if (!usuarioActual) {\r\n      console.warn(\"No hay usuario autenticado.\");\r\n      return;\r\n    }\r\n    \r\n    const { data, error } = await supabase\r\n      .from('profiles')\r\n      .select('username, avatar_url, gustos, logros')\r\n      .eq('username', usuarioActual.nombre) // 👈 Usa el nombre del usuario logeado\r\n      .single();\r\n\r\n    if (error) {\r\n      if (error.code === 'PGRST116') {\r\n        console.warn('Usuario no encontrado en la tabla de perfiles.');\r\n      } else {\r\n        throw error;\r\n      }\r\n    }\r\n    \r\n    if (data) {\r\n      profileData.value.username = data.username;\r\n      profileData.value.avatar_url = data.avatar_url;\r\n      profileData.value.gustos = data.gustos || [];\r\n      profileData.value.logros = data.logros || [];\r\n    }\r\n  } catch (error) {\r\n    console.error('Error al cargar datos del perfil:', error.message);\r\n  }\r\n};\r\n\r\nonMounted(() => {\r\n  fetchProfileData();\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}