{"ast":null,"code":"import { ref, onMounted } from \"vue\";\nimport { IonPage, IonHeader, IonToolbar, IonTitle, IonContent, IonCard, IonCardContent, IonItem, IonLabel, IonIcon, IonAccordion, IonAccordionGroup, IonImg, IonAvatar } from \"@ionic/vue\";\nimport { chevronDown } from \"ionicons/icons\";\nimport { createClient } from \"@supabase/supabase-js\";\n\n// üëâ Supabase Client\n\nexport default {\n  __name: 'PerfilView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const supabase = createClient(\"https://neffqwnqpcydidpkysfi.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\" // ‚ö†Ô∏è pon tu key real\n    );\n\n    // Perfil\n    const profileData = ref({\n      username: \"\",\n      avatar_url: \"\",\n      gustos: [],\n      logros: []\n    });\n    const avatarInput = ref(null);\n\n    // üëâ Cambiar avatar\n    const changeAvatar = () => {\n      avatarInput.value.click();\n    };\n    const handleFileChange = async event => {\n      const file = event.target.files[0];\n      if (!file) return;\n      try {\n        const filePath = `avatars/${profileData.value.username}/${Date.now()}.${file.name.split(\".\").pop()}`;\n        const {\n          data,\n          error\n        } = await supabase.storage.from(\"avatars\").upload(filePath, file);\n        if (error) throw error;\n        const publicUrl = `https://neffqwnqpcydidpkysfi.supabase.co/storage/v1/object/public/${data.path}`;\n        const {\n          error: updateError\n        } = await supabase.from(\"profiles\").update({\n          avatar_url: publicUrl\n        }).eq(\"username\", profileData.value.username);\n        if (updateError) throw updateError;\n        profileData.value.avatar_url = publicUrl;\n        alert(\"‚úÖ Imagen de perfil actualizada correctamente!\");\n      } catch (error) {\n        console.error(\"Error al subir la imagen:\", error.message);\n        alert(\"‚ùå Error al subir la imagen. Int√©ntalo de nuevo.\");\n      }\n    };\n\n    // üëâ Cargar datos del perfil\n    const fetchProfileData = async () => {\n      try {\n        const usuarioActual = JSON.parse(localStorage.getItem(\"usuario\"));\n        if (!usuarioActual) {\n          console.warn(\"No hay usuario autenticado.\");\n          return;\n        }\n        const {\n          data,\n          error\n        } = await supabase.from(\"perfiles\").select(\"nombre_perfil, avatar_url, gustos, logros\").eq(\"nombre_perfil\", usuarioActual.nombre).single();\n        if (error) throw error;\n        if (data) {\n          profileData.value.username = data.nombre_perfil;\n          profileData.value.avatar_url = data.avatar_url;\n          profileData.value.gustos = data.gustos || [];\n          profileData.value.logros = data.logros || [];\n        }\n      } catch (error) {\n        console.error(\"Error al cargar datos del perfil:\", error.message);\n      }\n    };\n    onMounted(() => {\n      fetchProfileData();\n    });\n    const __returned__ = {\n      supabase,\n      profileData,\n      avatarInput,\n      changeAvatar,\n      handleFileChange,\n      fetchProfileData,\n      ref,\n      onMounted,\n      get IonPage() {\n        return IonPage;\n      },\n      get IonHeader() {\n        return IonHeader;\n      },\n      get IonToolbar() {\n        return IonToolbar;\n      },\n      get IonTitle() {\n        return IonTitle;\n      },\n      get IonContent() {\n        return IonContent;\n      },\n      get IonCard() {\n        return IonCard;\n      },\n      get IonCardContent() {\n        return IonCardContent;\n      },\n      get IonItem() {\n        return IonItem;\n      },\n      get IonLabel() {\n        return IonLabel;\n      },\n      get IonIcon() {\n        return IonIcon;\n      },\n      get IonAccordion() {\n        return IonAccordion;\n      },\n      get IonAccordionGroup() {\n        return IonAccordionGroup;\n      },\n      get IonImg() {\n        return IonImg;\n      },\n      get IonAvatar() {\n        return IonAvatar;\n      },\n      get chevronDown() {\n        return chevronDown;\n      },\n      get createClient() {\n        return createClient;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","IonPage","IonHeader","IonToolbar","IonTitle","IonContent","IonCard","IonCardContent","IonItem","IonLabel","IonIcon","IonAccordion","IonAccordionGroup","IonImg","IonAvatar","chevronDown","createClient","supabase","profileData","username","avatar_url","gustos","logros","avatarInput","changeAvatar","value","click","handleFileChange","event","file","target","files","filePath","Date","now","name","split","pop","data","error","storage","from","upload","publicUrl","path","updateError","update","eq","alert","console","message","fetchProfileData","usuarioActual","JSON","parse","localStorage","getItem","warn","select","nombre","single","nombre_perfil"],"sources":["C:/Users/ellen/Downloads/App Myansite/Myansite Ionic/Myansite/Myansite/src/views/PerfilView.vue"],"sourcesContent":["<!-- eslint-disable vue/no-deprecated-slot-attribute -->\r\n\r\n<template>\r\n  <IonPage>\r\n    <IonHeader>\r\n      <IonToolbar>\r\n        <IonTitle>Perfil</IonTitle>\r\n      </IonToolbar>\r\n    </IonHeader>\r\n\r\n    <IonContent class=\"ion-padding\">\r\n      <IonCard>\r\n        <!-- Imagen de fondo -->\r\n        <IonImg src=\"\" alt=\"Fondo del perfil\" />\r\n\r\n        <IonCardContent>\r\n          <!-- Acordeones -->\r\n          <IonAccordionGroup>\r\n            <!-- Acorde√≥n Gustos -->\r\n            <IonAccordion value=\"gustos\">\r\n              <template #header>\r\n                <IonItem button>\r\n                  <IonLabel>Gustos</IonLabel>\r\n                  <IonIcon :icon=\"chevronDown\" slot=\"end\" />\r\n                </IonItem>\r\n              </template>\r\n\r\n              <template #content>\r\n                <div class=\"ion-padding\">\r\n                  <ul>\r\n                    <li\r\n                      v-for=\"(gusto, index) in profileData.gustos\"\r\n                      :key=\"index\"\r\n                    >\r\n                      {{ gusto }}\r\n                    </li>\r\n                  </ul>\r\n                </div>\r\n              </template>\r\n            </IonAccordion>\r\n\r\n            <!-- Acorde√≥n Logros -->\r\n            <IonAccordion value=\"logros\">\r\n              <template #header>\r\n                <IonItem button>\r\n                  <IonLabel>Logros</IonLabel>\r\n                  <IonIcon :icon=\"chevronDown\" slot=\"end\" />\r\n                </IonItem>\r\n              </template>\r\n\r\n              <template #content>\r\n                <div class=\"ion-padding\">\r\n                  <ul>\r\n                    <li\r\n                      v-for=\"(logro, index) in profileData.logros\"\r\n                      :key=\"index\"\r\n                    >\r\n                      {{ logro }}\r\n                    </li>\r\n                  </ul>\r\n                </div>\r\n              </template>\r\n            </IonAccordion>\r\n          </IonAccordionGroup>\r\n\r\n          <!-- Avatar y usuario -->\r\n          <div class=\"user-info-section\">\r\n            <div class=\"user-avatar-container\" @click=\"changeAvatar\">\r\n              <IonAvatar>\r\n                <IonImg\r\n                  :src=\"profileData.avatar_url\"\r\n                  alt=\"Avatar del usuario\"\r\n                />\r\n              </IonAvatar>\r\n              <input\r\n                type=\"file\"\r\n                ref=\"avatarInput\"\r\n                style=\"display: none\"\r\n                @change=\"handleFileChange\"\r\n                accept=\"image/*\"\r\n              />\r\n            </div>\r\n            <IonLabel class=\"username\">{{ profileData.username }}</IonLabel>\r\n          </div>\r\n        </IonCardContent>\r\n      </IonCard>\r\n    </IonContent>\r\n  </IonPage>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from \"vue\";\r\nimport {\r\n  IonPage,\r\n  IonHeader,\r\n  IonToolbar,\r\n  IonTitle,\r\n  IonContent,\r\n  IonCard,\r\n  IonCardContent,\r\n  IonItem,\r\n  IonLabel,\r\n  IonIcon,\r\n  IonAccordion,\r\n  IonAccordionGroup,\r\n  IonImg,\r\n  IonAvatar,\r\n} from \"@ionic/vue\";\r\nimport { chevronDown } from \"ionicons/icons\";\r\nimport { createClient } from \"@supabase/supabase-js\";\r\n\r\n// üëâ Supabase Client\r\nconst supabase = createClient(\r\n  \"https://neffqwnqpcydidpkysfi.supabase.co\",\r\n  \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\" // ‚ö†Ô∏è pon tu key real\r\n);\r\n\r\n// Perfil\r\nconst profileData = ref({\r\n  username: \"\",\r\n  avatar_url: \"\",\r\n  gustos: [],\r\n  logros: [],\r\n});\r\n\r\nconst avatarInput = ref(null);\r\n\r\n// üëâ Cambiar avatar\r\nconst changeAvatar = () => {\r\n  avatarInput.value.click();\r\n};\r\n\r\nconst handleFileChange = async (event) => {\r\n  const file = event.target.files[0];\r\n  if (!file) return;\r\n\r\n  try {\r\n    const filePath = `avatars/${profileData.value.username}/${Date.now()}.${file.name.split(\".\").pop()}`;\r\n\r\n    const { data, error } = await supabase.storage\r\n      .from(\"avatars\")\r\n      .upload(filePath, file);\r\n\r\n    if (error) throw error;\r\n\r\n    const publicUrl = `https://neffqwnqpcydidpkysfi.supabase.co/storage/v1/object/public/${data.path}`;\r\n\r\n    const { error: updateError } = await supabase\r\n      .from(\"profiles\")\r\n      .update({ avatar_url: publicUrl })\r\n      .eq(\"username\", profileData.value.username);\r\n\r\n    if (updateError) throw updateError;\r\n\r\n    profileData.value.avatar_url = publicUrl;\r\n    alert(\"‚úÖ Imagen de perfil actualizada correctamente!\");\r\n  } catch (error) {\r\n    console.error(\"Error al subir la imagen:\", error.message);\r\n    alert(\"‚ùå Error al subir la imagen. Int√©ntalo de nuevo.\");\r\n  }\r\n};\r\n\r\n// üëâ Cargar datos del perfil\r\nconst fetchProfileData = async () => {\r\n  try {\r\n    const usuarioActual = JSON.parse(localStorage.getItem(\"usuario\"));\r\n    if (!usuarioActual) {\r\n      console.warn(\"No hay usuario autenticado.\");\r\n      return;\r\n    }\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"perfiles\")\r\n      .select(\"nombre_perfil, avatar_url, gustos, logros\")\r\n      .eq(\"nombre_perfil\", usuarioActual.nombre)\r\n      .single();\r\n\r\n    if (error) throw error;\r\n\r\n    if (data) {\r\n      profileData.value.username = data.nombre_perfil;\r\n      profileData.value.avatar_url = data.avatar_url;\r\n      profileData.value.gustos = data.gustos || [];\r\n      profileData.value.logros = data.logros || [];\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Error al cargar datos del perfil:\", error.message);\r\n  }\r\n};\r\n\r\nonMounted(() => {\r\n  fetchProfileData();\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.user-info-section {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  margin-top: 16px;\r\n}\r\n\r\n.user-avatar-container {\r\n  cursor: pointer;\r\n}\r\n\r\n.username {\r\n  margin-top: 8px;\r\n  font-weight: bold;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}