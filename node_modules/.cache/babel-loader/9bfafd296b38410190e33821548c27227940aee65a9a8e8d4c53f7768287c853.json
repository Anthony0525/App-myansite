{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode, normalizeStyle as _normalizeStyle, unref as _unref, createVNode as _createVNode, withCtx as _withCtx, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"container\"\n};\nconst _hoisted_2 = {\n  class: \"main-content\"\n};\nconst _hoisted_3 = {\n  class: \"card-header\"\n};\nconst _hoisted_4 = [\"src\"];\nconst _hoisted_5 = [\"src\"];\nconst _hoisted_6 = {\n  class: \"sidebar\"\n};\nconst _hoisted_7 = {\n  class: \"suggestions\"\n};\nconst _hoisted_8 = {\n  class: \"suggestions-list\"\n};\nconst _hoisted_9 = {\n  key: 0,\n  class: \"loader\"\n};\nimport { ref, onMounted } from \"vue\";\nimport { createClient } from \"@supabase/supabase-js\";\nimport { IonPage, IonContent, IonInfiniteScroll, IonInfiniteScrollContent // üëà Importa los componentes de Infinite Scroll\n} from \"@ionic/vue\";\nimport \"../assets/contenido.css\";\n\n// Revisa que tengas estos componentes importados en MainLayout.vue\n// import { IonPage, IonHeader, IonToolbar, IonContent, IonRouterOutlet } from \"@ionic/vue\";\n\nconst limite = 5;\nexport default {\n  __name: 'ContenidoView',\n  setup(__props) {\n    const supabase = createClient(\"https://neffqwnqpcydidpkysfi.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5lZmZxd25xcGN5ZGlkcGt5c2ZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3Nzc5MTUsImV4cCI6MjA3MjM1MzkxNX0.I_fwrJYMhKoh2Irlhqub3B5Kn4-JxuJR-XnLhGjUykw\");\n    const publicaciones = ref([]);\n    const cargando = ref(false);\n    const pagina = ref(0);\n    const hayMasDatos = ref(true); // Controla si ya no hay m√°s para cargar\n\n    async function cargarPublicaciones() {\n      if (cargando.value) return;\n      cargando.value = true;\n      const startIndex = pagina.value * limite;\n      const endIndex = startIndex + limite - 1;\n      const {\n        data,\n        error\n      } = await supabase.from(\"publicaciones\").select(`id, nombre_publicacion, descripcion, media_url, perfiles (nombre_perfil, icono_url)`).order(\"created_at\", {\n        ascending: false\n      }).range(startIndex, endIndex);\n      cargando.value = false;\n      if (error) {\n        console.error(\"Error al cargar publicaciones:\", error);\n        hayMasDatos.value = false;\n        return;\n      }\n      if (data && data.length) {\n        publicaciones.value.push(...data);\n        pagina.value++;\n        // Si la cantidad de datos es menor que el l√≠mite, asumimos que no hay m√°s p√°ginas\n        if (data.length < limite) {\n          hayMasDatos.value = false;\n        }\n      } else {\n        // Si no hay datos, deshabilitamos la carga infinita\n        hayMasDatos.value = false;\n      }\n    }\n\n    // üí° FUNCI√ìN LLAMADA POR IONIC\n    async function cargarMasPublicaciones(event) {\n      // Si no hay m√°s datos, detenemos la funci√≥n.\n      if (!hayMasDatos.value) {\n        // Debemos completar el evento, aunque no haya cargado nada.\n        event.target.complete();\n        return;\n      }\n      await cargarPublicaciones();\n\n      // üîë IMPORTANTE: Finaliza el evento de carga de Ionic\n      event.target.complete();\n    }\n    onMounted(() => {\n      // Solo se carga la primera p√°gina al montar, el scroll lo manejar√° el IonInfiniteScroll\n      cargarPublicaciones();\n      // ‚ùå Se elimin√≥ la funci√≥n handleScroll y el window.addEventListener(\"scroll\", handleScroll)\n    });\n    return (_ctx, _cache) => {\n      return _openBlock(), _createBlock(_unref(IonPage), null, {\n        default: _withCtx(() => [_createVNode(_unref(IonContent), null, {\n          default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_1, [_createElementVNode(\"main\", _hoisted_2, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(publicaciones.value, pub => {\n            return _openBlock(), _createElementBlock(\"div\", {\n              key: pub.id,\n              class: \"card\"\n            }, [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"img\", {\n              src: pub.perfiles?.icono_url || 'https://i.pravatar.cc/40',\n              class: \"perfil-icono\"\n            }, null, 8, _hoisted_4), _createElementVNode(\"span\", null, _toDisplayString(pub.perfiles?.nombre_perfil || \"An√≥nimo\"), 1)]), _createElementVNode(\"h2\", null, _toDisplayString(pub.nombre_publicacion), 1), _createElementVNode(\"p\", null, _toDisplayString(pub.descripcion), 1), pub.media_url ? (_openBlock(), _createElementBlock(\"img\", {\n              key: 0,\n              src: pub.media_url,\n              class: \"media\"\n            }, null, 8, _hoisted_5)) : _createCommentVNode(\"\", true)]);\n          }), 128))]), _createElementVNode(\"aside\", _hoisted_6, [_createElementVNode(\"div\", _hoisted_7, [_cache[0] || (_cache[0] = _createElementVNode(\"p\", {\n            class: \"suggestions-title\"\n          }, \"Sugeridos!\", -1)), _createElementVNode(\"div\", _hoisted_8, [(_openBlock(), _createElementBlock(_Fragment, null, _renderList(6, i => {\n            return _createElementVNode(\"div\", {\n              key: i,\n              class: \"suggestion-icon\",\n              style: _normalizeStyle(`background-image:url(https://i.pravatar.cc/50?img=${i})`)\n            }, null, 4);\n          }), 64))])])])]), _createVNode(_unref(IonInfiniteScroll), {\n            onIonInfinite: cargarMasPublicaciones,\n            disabled: !hayMasDatos.value\n          }, {\n            default: _withCtx(() => [_createVNode(_unref(IonInfiniteScrollContent), {\n              \"loading-spinner\": \"bubbles\",\n              \"loading-text\": \"Cargando m√°s publicaciones...\"\n            })]),\n            _: 1\n          }, 8, [\"disabled\"]), cargando.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, \"Cargando...\")) : _createCommentVNode(\"\", true)]),\n          _: 1\n        })]),\n        _: 1\n      });\n    };\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}